(this.$WP=this.$WP||[]).push(["x8xtxr",(e,r)=>{var a,n,t,i,s,o,l,c,d,_,u,m,p,f,g,y,k,h,v,b,S,C,N,A,E,O,M,T,I,x={__key:89202799450714,id:"5121252c9a5ac957",loc:{},definitions:[]},R=(e,r,a)=>{switch(e){case"USERNAME_TOO_SHORT":return a.string("profile_update_error_username_too_short",{0:r});case"USERNAME_TOO_LONG":return a.string("profile_update_error_username_too_long",{0:r});case"USERNAME_INVALID_CHARACTERS":return a.string("mobile_profile_update_error_username_invalid_characters");case"USERNAME_ALREADY_EXISTS":return a.string("profile_update_error_username_already_exists",{0:r});case"USERNAME_CONTAINS_PROFANITY":return a.string("profile_update_error_contains_profanity");case"USERNAME_CONTAINS_TA_WORDS":return a.string("profile_update_error_username_contains_ta_words");default:return console.error(`Unknown username edit error: ${String(e)}`),a.string("social_loading_error_1")}},P=({value:e,submitError:r,onChange:n})=>{var{localize:t}=y(),[c,d]=i(e),[_,u]=i(null),{data:m}=k({query:x,variables:s(()=>({username:c}),[c]),pause:!c,wait:500}),h=m?.checkUsername?.status;o(()=>{h&&("OK"!==h?"USERNAME_IS_SAME"===h?u(null):u(N(h,c||t.string("social_edit_profile_username"),t)):u(null))},[c,n,h,t]),o(()=>{n(c)},[n,c]);var v=l(e=>{d(e.currentTarget.value)},[]),b=_||r;return a(p,{label:a(f,{variant:"title-04",children:a(g,{id:"social_edit_profile_username"})}),maxLength:20,value:c,onChange:v,placeholder:t.string("onboarding_social_name_screen_username_ghost_text"),helperText:b?void 0:t.string("onboarding_social_name_screen_username_helper_text_period_814"),errorText:b||void 0})},U=/^[a-zA-Z]+\d{11}$/,w=e=>e&&"string"==typeof e&&e.match(U),D=({initialUsername:e,displayName:r,onUserNameChange:t,onDisplayNameChange:s,hasDisplayNameError:o,error:c})=>{var[d,_]=i(w(e)?"":e),[u,k]=i(void 0),h=l(e=>{_(e),k(void 0),t(e)},[t]),v=l(e=>{s(e.target.value)},[s]),{localize:b}=y();return n("div",{className:"HoEts A",children:[a(m,{size:"medium",source:"/img2/ds/avatar.svg"}),a(f,{variant:"title-02",children:a(g,{id:"onboarding_social_name_screen_returning_header"})}),a(p,{label:a(f,{variant:"title-04",children:a(g,{id:"onboarding_social_name_screen_display_name_field_v2"})}),maxLength:40,value:r||"",onChange:v,placeholder:b.string("onboarding_social_name_screen_display_name_ghost_text"),helperText:o&&c?void 0:b.string("onboarding_social_name_screen_display_name_helper_text_period_814"),errorText:o&&c?c.message:void 0}),a(A,{value:d,submitError:u,onChange:h})]})},L={usernameWrapper:"oJnZV",spinner:"dYBnZ u",error:"OzSxX c",error_button:"dTghW"},q={__key:27894327331877,id:"195ea778cc251f95",loc:{},definitions:[]},Y={__key:0x64442f9a8c86,id:"64442f9a8c866305",loc:{},definitions:[]},W=()=>{var e=b(),r=C(),[,a]=c(q),[,n]=c(Y);return[t.useCallback((n,t)=>{O.has(n)||(O.add(n),a({userId:e,taUnique:r,cardId:n,cardAction:t}))},[a,r,e]),t.useCallback((a,t)=>{M.has(a)||(M.add(a),n({userId:e,taUnique:r,cardId:a,cardState:t}))},[n,r,e])]},$={__key:3855585932847,id:"0381b2d4762fe65b",loc:{},definitions:[]},z={__key:0xfd595b8bd209,id:"fd595b8bd2098a90",loc:{},definitions:[]},F={__key:0xad769977856f,id:"ad769977856f588a",loc:{},definitions:[]},H="ONBOARDING_CONFIRM_USER",G=/^[a-zA-Z]+\d{11}$/,j=e=>e&&"string"==typeof e&&e.match(G),B=e=>!!e.states&&!!e.states.find(e=>e?.id===H&&e?.state==="COMPLETED"),K=({trackingModule:e,usernameMutationVars:r,screenCompleteMutationVars:a,onProfileValid:n,screenCompleteCallback:i,textInputIsInvalid:s})=>{var[,o]=c($),[,l]=c(z),d=S();return t.useCallback(()=>{d({module:e,action:"namescreen_confirm_click",context:""}),s()||l(r).then(({data:e})=>{n(e?.updateMemberProfile?.status)&&(o(a),i&&i())})},[o,n,i,a,s,d,e,r,l])},Z=({onComplete:e,...r})=>{var i=S(),[s,o]=t.useState(j(r.displayName)?"":r.displayName),[l,d]=t.useState(j(r.username)?"":r.username),[u,m]=t.useState(null),{localize:p}=y();t.useEffect(()=>{var e=j(r.username);i({module:r.trackingModule,action:"namescreen_displayname",context:r.displayName&&!e?"prefilled":"blank"}),i({module:r.trackingModule,action:"namescreen_username",context:r.username&&!e?"prefilled":"blank"})},[r.displayName,r.trackingModule,r.username,i]);var f=t.useCallback((e,r)=>{m({message:e,field:r,advisory:!1})},[]),g=t.useCallback(e=>{var r=s||p.string("onboarding_social_name_screen_display_name_field_v2");switch(e){case"DISPLAYNAME_TOO_SHORT":f(p.string("mobile_profile_update_error_display_name_too_short"),"displayname");break;case"DISPLAYNAME_TOO_LONG":f(p.string("profile_update_error_display_name_too_long",{0:r}),"displayname");break;case"DISPLAYNAME_CONTAINS_PROFANITY":f(p.string("profile_update_error_contains_profanity"),"displayname");break;case"DISPLAYNAME_CONTAINS_TA_WORDS":f(p.string("profile_update_error_username_contains_ta_words"),"displayname");break;default:console.error(`Unknown username edit error: ${String(e)}`),f(p.string("social_loading_error_1"),"username")}},[p,s,f]),k=t.useCallback(e=>{o(e)},[]),h=t.useCallback(e=>u?.field===e,[u]),v=t.useCallback(e=>"OK"===e?(i({module:r.trackingModule,action:"namescreen_complete_success",context:""}),!0):(g(e),i({module:r.trackingModule,action:"namescreen_submit_error",context:e||""}),!1),[r.trackingModule,g,i]),b=t.useCallback(e=>{d(e)},[]),C=t.useCallback(()=>s?!l:(g("DISPLAYNAME_TOO_SHORT"),!0),[s,g,l]),[N]=T();t.useEffect(()=>{N(H,"SHOW")},[N]);var A=t.useMemo(()=>({userId:r.userId,displayName:s,username:l}),[s,r.userId,l]),[,O]=c(z);t.useEffect(()=>{O(A).then(({data:e})=>{var r=e?.updateMemberProfile?.status;r&&"OK"!==r&&g(r)})},[O,A,g]);var M=t.useMemo(()=>({cardId:H,cardState:"COMPLETED",newlyAccepted:!r.acceptedTou}),[r.acceptedTou]),I=K({trackingModule:r.trackingModule,usernameMutationVars:A,screenCompleteMutationVars:M,screenCompleteCallback:e,onProfileValid:v,textInputIsInvalid:C});return n("div",{className:L.usernameWrapper,onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),I())},children:[a(E,{initialUsername:l||"",displayName:s,onUserNameChange:b,onDisplayNameChange:k,hasDisplayNameError:h("displayname"),error:u}),a(_,{onClick:I})]})},Q=e=>{var r=b(),i=S(),[{fetching:s,data:o,error:l},c]=d({query:F,variables:{userId:r||""},requestPolicy:"network-only"});if(t.useEffect(()=>{l&&(console.error(`Error in ConfirmUsername query: ${l.message}`),i({module:e.trackingModule,action:"confirmusername_query_error_shown",context:r||""}))},[i,e.trackingModule,r,l]),l)return n("div",{className:L.error,children:[a(g,{id:"compliment_9bd"}),n("div",{className:L.error_button,children:[a(v,{legacyStyled:!0,variant:"primary",onClick:()=>c(),children:a(g,{id:"link_uploader_refresh"})}),a(v,{legacyStyled:!0,variant:"primary",onClick:e.closerForError,children:a(g,{id:"btn_cancel"})})]})]});if(s)return a("div",{className:L.spinner,children:a(h,{})});if(o){var _=!!o.getTermOfUseAcceptanceInfo&&!!o.getTermOfUseAcceptanceInfo.accepted,u=o.insightProfile?o.insightProfile.uiCardsState:{states:[]};if(u&&B(u)&&_&&e.onComplete)return e.onComplete(),null;var m=o.memberProfiles?.[0];return a(Z,{userId:r||"",displayName:m?.displayName||"",username:m?.username||"",onComplete:e.onComplete,onSkip:e.onSkip,allowSkip:e.allowSkip,trackingModule:e.trackingModule,acceptedTou:_})}return null},V={__key:0xac7e7c19e33,id:"0ac7e7c19e3398ec",loc:{},definitions:[]},X=()=>{},J=e=>e.states.find(e=>"ONBOARDING_CONFIRM_USER"===e.id&&"COMPLETED"===e.state),ee=({onComplete:e,onClose:r})=>a(u,{children:a(I,{onComplete:t.useCallback(()=>{e?.()},[e]),closerForError:t.useCallback(()=>{r?.()},[r]),onSkip:X,trackingModule:"Social_onboarding_gatedaction",allowSkip:!1})}),er=({onClose:e,onComplete:r,forceTermsOfUse:n})=>{var[t]=d({query:V});if(n)return a(ee,{onClose:e,onComplete:r});if(t.fetching)return null;if(t.error&&t.error.message,t.data){var i=t.data.getTermOfUseAcceptanceInfo&&t.data.getTermOfUseAcceptanceInfo.accepted,s=t.data.insightProfile&&t.data.insightProfile.uiCardsState;return i&&s&&J(s)?(r?.(),null):a(ee,{onClose:e,onComplete:r})}return a(ee,{onClose:e,onComplete:r})};return[()=>{N=R,A=P,E=D,O=new Set,M=new Set,T=W,I=Q,er.defaultProps={forceTermsOfUse:!1},e({TermsOverlayQuery:V,default:er})},[e=>(a=e.jsx,n=e.jsxs),e=>(t=e,i=e.useState,s=e.useMemo,o=e.useEffect,l=e.useCallback),e=>(c=e.useMutation,d=e.useQuery),e=>(_=e.NextButton,u=e.Modal),e=>m=e.Avatar,e=>p=e.TextInput,e=>f=e.default,e=>(g=e.default,y=e.useLocalize),e=>k=e.useDebouncedQuery,e=>h=e.LoadingSpinner,e=>v=e.default,e=>b=e.useUserId,e=>S=e.useGARecorder,e=>C=e.useDeviceId]]},["21h32l","o4yt4q","mqwhqn","afr6ia","ljqkwp","u3aiot","essqvy","7thqz4","fbuhsy","l9qeu7","jppfwt","52far5","32pwc7","p5p2yo"]]);
