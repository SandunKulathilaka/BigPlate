(this.$WP=this.$WP||[]).push(["iahtok",(e,o)=>{var a,r,i,t,l,d,n,s,p,u,c,m,h,I,g,v,_,f,U,T,A,w,F,P,L,b,E,y,N,O,x,D,S,C,R,M,k,Z,$,z,B,W,j,q,V,Y,G,H,K,J,X,Q,ee,eo,ea,er,ei,et,el,ed,en,es,ep,eu,ec,em,eh,eI=[".mp4",".m4v",".mov"],eg=(e,o,a)=>{var{localize:r}=v(),i=t(e=>"video"===a?`${e.name}: ${r.string("post_video_file_type_error")}`:`${e.name}: ${r.string("post_photo_unsupported_file")}`,[r,a]),l=t(e=>"video"===a?`${e.name}: ${r.string("post_video_size_error")}`:`${e.name}: ${r.string("file_size_too_big_photo_oops_message",{0:r.string("mobile_offline_megabyte_ffffec6c",{0:o/1024/1024})})}`,[r,o,a]);return t(r=>{if(r.size>o)return Promise.reject(new K(l(r)));var t=w(r.name);if(!t||!e.includes(t))return Promise.reject(new J(i(r)));var d=eI.includes(t);return"video"===a||void 0===a&&d?Promise.resolve():new Promise((e,o)=>{var a=new Image;a.onload=()=>{URL.revokeObjectURL(a.src),e()},a.onerror=()=>o(new J(i(r))),a.src=URL.createObjectURL(r)})},[e,o,i,l,a])},ev=(e,o)=>{var[a,r]=l(!1),i=T();return N("dragover",e=>{null!=e.dataTransfer&&[...e.dataTransfer.items].some(e=>"file"===e.kind)&&(e.dataTransfer.dropEffect="copy",e.preventDefault(),r(!0))}),N("dragleave",e=>{a&&(e.preventDefault(),r(!1))}),N("drop",t=>{if(a){t.preventDefault(),r(!1);var l=[];null!=t.dataTransfer&&(l=(t.dataTransfer.items?[...t.dataTransfer.items].map(e=>e.getAsFile()):[...t.dataTransfer.files]).filter(Boolean)),l.length>0&&(null!==o&&i({PhotoUploadFlow:{photoUploadWeb:{action:"fileSelectedDragDrop",description:o.length.toString()}}}),e(l))}}),{dragging:a}},e_={__key:66582613602301,id:"3c8e79082ffdad6e",loc:{},definitions:[]},ef={__key:36757335530949,id:"216e3bed5dc5e3b2",loc:{},definitions:[]};function eU(e,o,a){return o in e?Object.defineProperty(e,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[o]=a,e}var eT=e=>new Promise((o,a)=>{var r=new Image;r.onload=()=>{URL.revokeObjectURL(r.src),o({width:r.width,height:r.height})},r.onerror=a,r.src=URL.createObjectURL(e)}),eA=(e,o,a,r)=>{e({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFailStatus",description:o.statusText}}}),e({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFailStatusCode",description:o.status}}}),e({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFailResponse",description:o.response.toString()}}}),e({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFail",description:`${a+1} of ${r}`}}}),console.error(`MEDIA_UPLOAD_ERROR: ${JSON.stringify({status:o.status,statusText:o.statusText,response:o.response.toString(),fileIndex:a+1,fileCount:r})}`)},ew=(e,o,a,r,i,t,l,d,n,s,p)=>new Promise((u,c)=>{var m=d=>{var m,I=!1,g=new Date().getTime(),v=()=>{null!==n&&(m&&clearTimeout(m),m=setTimeout(()=>{I=!0,r({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFail",description:`${i+1} of ${t} upload has timed out after ${(new Date().getTime()-g)/1e3} seconds`}}}),console.error("MEDIA_UPLOAD_ERROR: Upload has timed out"),_.abort()},n))},_=new XMLHttpRequest;_.onload=()=>{m&&clearTimeout(m),200===_.status?(l||r({PhotoUploadFlow:{photoUploadWeb:{action:"uploadSuccess",description:`${i+1} of ${t}`}}}),u(o)):(p(),l||eA(r,_,i,t),c(Error(`Upload of file ${e.name} failed.`)))},_.onerror=()=>{p(),m&&clearTimeout(m),l||eA(r,_,i,t),c(Error(`Upload of file ${e.name} failed.`))},_.onabort=()=>(m&&clearTimeout(m),I)?h(d):(p(),c(Error(`Upload of file ${e.name} aborted.`))),_.upload.onprogress=e=>{v(),s(e.loaded)},_.open("PUT",a,!0),_.send(e),v()},h=e=>{var o=e-1;o<0?c(new eo):m(o)};h(d)}),eF={INITIALIZATION:19,UPLOAD:3,FINALIZE:19},eP=(e=null,o=1)=>{var a=T(),[r,i]=l(null),[s,p]=l({queue:[],counts:{INITIALIZATION:0,UPLOAD:0,FINALIZE:0}}),u=d(!1);n(()=>(u.current=!0,()=>{u.current=!1}),[]);var[,c]=O(e_),[,m]=O(ef),h=D(S),I=C(S),g=R(S),v=M(S),_=k(S),f=Z(S),U=t(e=>{if(u.current)return e;throw _(),Error("upload aborted")},[_]),A=t((e,o)=>new Promise(o=>{p(a=>({...a,queue:[...a.queue,{uploaderStep:e,resolve:()=>o(!0),uid:x()}]}))}).then(o),[]),w=t(e=>{p(o=>({...o,counts:{...o.counts,[e]:o.counts[e]-1}}))},[]);n(()=>{if(s.queue.length>0){var e={...s.counts},o={...s.counts},a=[],r=[];Object.keys(s.counts).forEach(o=>{var i=s.queue.filter(e=>e.uploaderStep===o);if(s.counts[o]<eF[o]){var t=eF[o]-s.counts[o],l=i.slice(0,t);r.push(...l),a.push(...l.map(e=>e.uid)),e[o]+=l.length}}),r.length>0&&(p(r=>({...r,queue:r.queue.filter(e=>!a.includes(e.uid)),counts:{INITIALIZATION:e.INITIALIZATION-(o.INITIALIZATION-r.counts.INITIALIZATION),UPLOAD:e.UPLOAD-(o.UPLOAD-r.counts.UPLOAD),FINALIZE:e.FINALIZE-(o.FINALIZE-r.counts.FINALIZE)}})),r.forEach(e=>e.resolve()))}},[s]);var F=t(({mediaType:r,file:t,description:l,locationId:d,isForCuration:n,isForUserReview:s,isAllowedNonLoggedInUpload:p,pid:u,pidAttr:_,uploaderProgressData:T},F,P)=>{var L=T?.uploaderStep||"INITIALIZATION",b=T?.mediaId,E=T?.uploadUrl,y={description:l,mediaType:"video"===r?"VIDEO":"PHOTO",mimeType:t.type,mediaProvider:"TRIPADVISOR",mediaUploadProvider:"USER",fileName:t.name,fileSize:t.size,locationIds:null!=d&&d>0?[d]:[],isForCuration:n,isForUserReview:s,isAllowedNonLoggedInUpload:p,pid:u,pidAttr:_},N=e=>(h(e.length),c({request:e})),O=()=>{var e=[y],o="video"!==r;return("video"===r?N(e):eT(t).then(({width:e,height:a})=>(e&&a&&e>0&&a>0&&(o=!1),N([{...y,width:e,height:a}])))).then(U).then(({data:e,error:a})=>{if(a||e?.MediaSvcClient_initiateMediaBatchUploadWithProvidedFields?.[0]?.status!=="OK"||e?.MediaSvcClient_initiateMediaBatchUploadWithProvidedFields?.[0]?.mediaId==null||e?.MediaSvcClient_initiateMediaBatchUploadWithProvidedFields?.[0]?.uploadUrl==null){if(a&&console.error(`MEDIA_UPLOAD_ERROR: ${a.toString()}`),e?.MediaSvcClient_initiateMediaBatchUploadWithProvidedFields?.[0]?.status==="RATE_LIMITED")throw v(),new ea;throw g(),console.error(`Upload media error (internal): ${a}`),Error("Upload failed")}var{mediaId:r,uploadUrl:i}=e?.MediaSvcClient_initiateMediaBatchUploadWithProvidedFields?.[0];b=r,E=i,o&&console.error(`Upload media does not have dimensions mediaId/Url: ${b}/${E}`)}).then(e=>(w("INITIALIZATION"),e)).then(D)},x=()=>{if(L="UPLOAD",!b||!E)throw Error("Upload failed, mediaId or uploadUrl not provided");return ew(t,b,E,a,F,P.length,"video"===r,o,e,e=>i(o=>{var a=null==o?[]:[...o];return a[F]=e,a}),f).then(U).then(e=>(w("UPLOAD"),e)).then(e=>C(e))},D=()=>A("UPLOAD",x),S=(e=b)=>{if(L="FINALIZE",e)return m({request:{mediaId:e}}).then(()=>(I(1),{mediaId:e,mediaType:r})).then(e=>(w("FINALIZE"),e));throw Error("Finalization failed, mediaId not provided")},C=e=>A("FINALIZE",()=>S(e));return({INITIALIZATION:()=>A("INITIALIZATION",O),UPLOAD:D,FINALIZE:C})[L]().catch(e=>{throw w(L),new er({mediaId:b,uploaderStep:L,uploadUrl:E},e)}).finally(()=>{i(null)})},[m,c,h,g,I,f,v,U,A,w,a,o,e]);return[{progress:r},t(e=>e.map(F),[F])]},eL=(e,o)=>e.name===o.name&&e.size===o.size,eb={media:[],error:null},eE=({mediaType:e,withMetadata:o,isForCuration:a,allowedFileTypes:r,maxFileSize:i,maxAllowedFiles:d,locationId:n})=>{var s=T(),{localize:p}=v(),u=eg(r,i,e),[c,m]=l(eb),h=t(e=>{m(o=>({...o,error:e}))},[]),[I,g]=l(!1),_="video"===e,f=_?et.maxAllowedFiles:ei.maxAllowedFiles,U=t(o=>{u(o).then(()=>{m(r=>r.media.some(e=>eL(e.file,o))?r:r.media.length>=d?d!==f?r:{error:_?p.string("video_upload_max_number",{nVideos:d}):p.string("post_photo_tips_guidelines"),media:r.media}:{error:r.error,media:[...r.media,{mediaType:e,file:o,description:"",locationId:n,isForCuration:a}]})}).catch(e=>{_||s({PhotoUploadFlow:{photoUploadWeb:{action:"invalidFile",description:e.message}}}),h(e.message)})},[u,d,a,n,p,h,e,f,_,s]),A=t(e=>{h(null),e.preventDefault(),[...e.target.files??[]].forEach(U),_||s({PhotoUploadFlow:{photoUploadWeb:{action:"fileSelectedFilePicker",description:c.media.length.toString()}}}),e.currentTarget.value=""},[U,h,s,_,c.media.length]),w=t((e,o)=>{m(a=>{var r=[...a.media];return r[e]=o,{error:null,media:r}})},[]),F=t(e=>{m(o=>{var a=[...o.media];return a.splice(e,1),{error:null,media:a}})},[]),{dragging:P}=ev(e=>{h(null),e.forEach(U)},_?null:c.media),L=!I&&c.media.length>0&&(!o||!_&&a||c.media.every(e=>e.description&&null!=e.locationId&&e.locationId>0)),[{progress:b},E]=eP(),y=t(()=>L?(_||s({PhotoUploadFlow:{photoUploadWeb:{action:"submitClicked"}}}),g(!0),h(null),Promise.all(E(c.media)).then(e=>(_||s({PhotoUploadFlow:{photoUploadWeb:{action:"uploadedAll"}}}),g(!1),e)).catch(()=>{_||s({PhotoUploadFlow:{photoUploadWeb:{action:"uploadedErrorExists"}}}),h(_?p.string("video_upload_fail"):p.string("post_photo_upload_failed")),g(!1)})):Promise.reject(),[E,L,c.media,h,p,_,s]);return{media:c.media,error:c.error,uploading:I,progress:b,canAddMore:c.media.length<d,canSubmit:L,dragging:P,onFileSelected:A,onMediaChanged:w,onMediaDeleted:F,onSubmit:y,resetMediaState:()=>m(eb)}},ey={__key:0xac16b35df15,id:"0ac16b35df152d66",loc:{},definitions:[]},eN={__key:0xdc51c969080a,id:"dc51c969080a7a5d",loc:{},definitions:[]},eO=(e,o,a,r)=>{e({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFailStatus",description:o.statusText}}}),e({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFailStatusCode",description:o.status?o.status.toString():""}}}),e({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFailResponse",description:o.response.toString()}}}),e({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFail",description:`${a+1} of ${r}`}}}),console.error(`MEDIA_UPLOAD_ERROR: ${JSON.stringify({status:o.status,statusText:o.statusText,response:o.response.toString(),fileIndex:a+1,fileCount:r})}`)},ex=(e,o,a,r,i,t,l,d,n,s,p)=>new Promise((u,c)=>{var m=d=>{var m,I=!1,g=()=>{null!==n&&(m&&clearTimeout(m),m=setTimeout(()=>{I=!0,r({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFail",description:`${i+1} of ${t} upload has timed out`}}}),console.error("MEDIA_UPLOAD_ERROR: Upload has timed out"),v.abort()},n))},v=new XMLHttpRequest;v.open("PUT",a,!0),v.onload=()=>{m&&clearTimeout(m),200===v.status?(l||r({PhotoUploadFlow:{photoUploadWeb:{action:"uploadSuccess",description:`${i+1} of ${t}`}}}),u(o)):(p(),l||eO(r,v,i,t),c(Error(`Upload of file ${e.name} failed.`)))},v.onerror=()=>{p(),m&&clearTimeout(m),l||eO(r,v,i,t),c(Error(`Upload of file ${e.name} failed.`))},v.onabort=()=>(m&&clearTimeout(m),I)?h(d):(p(),c(Error(`Upload of file ${e.name} aborted.`))),v.upload.onprogress=e=>{g(),s(e.loaded)},v.send(e),g()},h=e=>{var o=e-1;o<0?c(new X):m(o)};h(d)});function eD(e,o,a){return o in e?Object.defineProperty(e,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[o]=a,e}var eS=e=>{var o,a="video"===e.mediaType?"VIDEO":"PHOTO",r={albumId:e.categoryId,description:e.description,mimeType:e.file.type,fileName:e.file.name,fileSize:e.file.size,mediaType:a};return"VIDEO"!==a?(o=e.file,new Promise((e,a)=>{var r=new Image;r.onload=()=>{URL.revokeObjectURL(r.src),e({width:r.width,height:r.height})},r.onerror=a,r.src=URL.createObjectURL(o)})).then(({width:e,height:o})=>({...r,width:e,height:o})).catch(e=>(console.error(`Error parsing image dimensions: ${e.message}`),new Promise(e=>{e(r)}))):new Promise(e=>{e(r)})},eC={INITIALIZATION:100,UPLOAD:3,FINALIZE:19},eR=(e=null,o=1)=>{var a=T(),[r,i]=l(null),[s,p]=l({queue:[],counts:{INITIALIZATION:0,UPLOAD:0,FINALIZE:0}}),u=d(!1);n(()=>(u.current=!0,()=>{u.current=!1}),[]);var[,c]=O(ey),[,m]=O(eN),h=D(S),I=C(S),g=R(S),v=M(S),_=k(S),f=Z(S),U=t(e=>{if(u.current)return e;throw _(),Error("upload aborted")},[_]),A=t((e,o)=>new Promise(o=>{p(a=>({...a,queue:[...a.queue,{uploaderStep:e,resolve:()=>o(!0),uid:x()}]}))}).then(o),[]),w=t(e=>{p(o=>({...o,counts:{...o.counts,[e]:o.counts[e]-1}}))},[]);n(()=>{if(s.queue.length>0){var e={...s.counts},o={...s.counts},a=[],r=[];Object.keys(s.counts).forEach(o=>{if(s.counts[o]<eC[o]){var i=s.queue.filter(e=>e.uploaderStep===o),t=eC[o]-s.counts[o],l=i.slice(0,t);r.push(...l),a.push(...l.map(e=>e.uid)),e[o]+=l.length}}),r.length>0&&(p(r=>({...r,queue:r.queue.filter(e=>!a.includes(e.uid)),counts:{INITIALIZATION:e.INITIALIZATION-(o.INITIALIZATION-r.counts.INITIALIZATION),UPLOAD:e.UPLOAD-(o.UPLOAD-r.counts.UPLOAD),FINALIZE:e.FINALIZE-(o.FINALIZE-r.counts.FINALIZE)}})),r.forEach(e=>e.resolve()))}},[s]);var F=t(e=>{var o=e=>(h(e.length),c({request:e})),a=e.filter(e=>!e.uploaderProgressData?.mediaId||!e.uploaderProgressData?.uploadUrl).map(e=>eS(e));if(0===a.length)return new Promise(o=>{o(e.filter(Boolean))});var{locationId:r,isForCuration:i,isForUserReview:t,isAllowedNonLoggedInUpload:l,pid:d,pidAttr:n}=e[0];return Promise.all(a).then(e=>o([{mediaToUpload:e,mediaProvider:"TRIPADVISOR",mediaUploadProvider:"USER",locationIds:null!=r&&r>0?[r]:[],isForCuration:i,isForUserReview:t,isAllowedNonLoggedInUpload:l,pid:d,pidAttr:n}])).then(U).then(({data:o,error:a})=>{a&&console.error(`MEDIA_UPLOAD_ERROR: ${a.toString()}`);var r=o?.MediaSvcClient_initiateMediaArrayBatchUpload?.[0]?.media?.filter(e=>!!(e?.status==="OK"&&e?.mediaId&&e?.uploadUrl)||(e?.status==="RATE_LIMITED"?v():g(),!1));if(!r?.length)throw Error("Upload failed, failed to call initialization");return e.map((e,a)=>{var r=o?.MediaSvcClient_initiateMediaArrayBatchUpload?.[0]?.media?.[a]?.mediaId||0,i=o?.MediaSvcClient_initiateMediaArrayBatchUpload?.[0]?.media?.[a]?.uploadUrl||"",t={...e.uploaderProgressData,uploaderStep:"INITIALIZATION",mediaId:r,uploadUrl:i};return{...e,uploaderProgressData:t}})})},[U,c,h,g,v]),P=t((r,t,l)=>{var d=r?.uploaderProgressData,n=d?.uploaderStep||"INITIALIZATION",{mediaType:s}=r,p=d?.mediaId,u=d?.uploadUrl,c=()=>new Promise((e,o)=>{d?.mediaId!==0&&d?.uploadUrl!==""&&e(r),o(Error("Initialization failed."))}).then(e=>(w("INITIALIZATION"),e)).then(g),h=()=>{if(n="UPLOAD",!d||!d.mediaId||!d.uploadUrl)throw Error("Upload failed, mediaId or uploadUrl not provided");return ex(r.file,d.mediaId,d.uploadUrl,a,t,l.length,"video"===r.mediaType,o,e,e=>i(o=>{var a=null==o?[]:[...o];return a[t]=e,a}),f).then(U).then(e=>(w("UPLOAD"),e)).then(e=>_(e))},g=()=>A("UPLOAD",h),v=(e=p)=>{if(n="FINALIZE",e)return m({request:[{mediaIds:[e]}]}).then(()=>(I(1),{mediaId:e,mediaType:s})).then(e=>(w("FINALIZE"),e));throw Error("Finalization failed, mediaId not provided")},_=e=>A("FINALIZE",()=>v(e));return({INITIALIZATION:()=>A("INITIALIZATION",c),UPLOAD:g,FINALIZE:_})[n]().catch(e=>{throw w(n),new ee({mediaId:p,uploaderStep:n,uploadUrl:u},e)}).finally(()=>{i(null)})},[m,I,f,U,A,w,a,o,e]);return[{progress:r},t(e=>F(e).then(e=>e.map(P)),[P,F])]},eM=({children:e,timeout:o,retryCount:i,mediaType:u,onRateLimitedError:c,beforePhotoUploadCheck:m,handleErrorsManually:h,...I})=>{var[v,U]=s(_),T=d(null),A={...ed,..."photo"===u&&ei,..."video"===u&&et,...I},[F,P]=l([]),[b,y]=l([]),[{progress:N},O]=eP(o,i),[{progress:D},S]=eR(o,i),C=eg(A.allowedFileTypes,A.maxFileSize),R=A.batchedUpload?D:N,M=d([]),k=t(e=>{M.current.splice(0,0,e)},[]),Z=t(e=>{var o=M.current.findIndex(o=>e===o);M.current.splice(o,1)},[]),$=t(()=>{var e=T.current;if(null==e)throw Error("useCustomPhotoUploadFlow: must render the supplied element");e.click()},[]),z=t(e=>{P(e),S(e).then(o=>o.forEach((o,a)=>{o.then(o=>{y(r=>r.map(r=>r.uploadId===e[a].uploadId?{...r,result:o}:r))}).catch(o=>{var r=o?.uploaderProgressData,i=o?.originalError||o;y(o=>o.map(o=>o.uploadId===e[a].uploadId?{...o,result:{definition:{...e[a],uploadId:o.uploadId,uploaderProgressData:r},error:i}}:o))})})).catch(o=>{y(a=>a.map(a=>{var r=e.find(e=>e.uploadId===a.uploadId);if(!r)return a;var i={definition:{...r,mediaType:r.mediaType,uploaderProgressData:void 0,uploadId:a.uploadId},error:o};return{...a,result:i}}))})},[S]),B=t(e=>{P(e),O(e).forEach((o,a)=>{o.then(o=>{y(r=>r.map(r=>r.uploadId===e[a].uploadId?{...r,result:o}:r))}).catch(o=>{var r=o?.uploaderProgressData,i=o?.originalError||o;y(o=>o.map(o=>o.uploadId===e[a].uploadId?{...o,result:{definition:{...e[a],uploadId:o.uploadId,uploaderProgressData:r},error:i}}:o))})})},[O]),W=A.batchedUpload?z:B,j=t(e=>{var o=e.map(e=>({...e,uploadId:e.uploadId||x()})),a=o.filter(e=>!e?.error);m&&!1===m(a)||(y(e=>[...e,...o.map(e=>({uploadId:e.uploadId,result:e?.error?{fileName:e?.fileName,error:e?.error}:null}))]),W(a))},[W,m]),q=t(e=>{var o=e.map(e=>({...e,uploadId:e.uploadId||x()}));m&&!1===m(o)||(y(e=>[...e,...o.map(e=>({uploadId:e.uploadId,result:null}))]),W(o))},[W,m]);n(()=>{if(b.length>0&&b.every(e=>!!e.result)){var e=b.filter(e=>e.result?.mediaId).map(e=>e.result),o=b.filter(e=>e.result?.error).map(e=>e.result).map(e=>e.error);!h&&o[0]&&(o[0]instanceof eo||o[0]instanceof X?v({node:a(f,{cta:a(E,{trailing:!0,variant:"on-dark",onClick:()=>{q(F),U()},icon:L,children:"Click to retry"}),children:"Upload failed."}),timeout:1e4}):(o[0]instanceof ea||o[0]instanceof Q)&&c?c($):v({node:a(f,{children:o[0].message||a(g,{id:"post_photo_upload_failed"})})})),h&&o.find(e=>e instanceof ea||e instanceof Q)&&c&&c($),(h||!o[0])&&M.current.find(o=>!1!==o(e,b)),P([]),y([])}},[b,F.length,h,U,v,c,$,F,q]);var V=t(e=>{Promise.allSettled(e.map(e=>C(e))).then(o=>{var a=e.map((e,a)=>"fulfilled"===o[a].status?{mediaType:et.allowedFileTypes.includes(w(e.name))?"video":"photo",file:e,locationId:-1===A.locationId?null:A.locationId,description:"",isForCuration:A.isForCuration,isForUserReview:A.isForUserReview,isAllowedNonLoggedInUpload:A.isAllowedNonLoggedInUpload,pid:A.pid,pidAttr:A.pidAttr,uploadId:x()}:{fileName:e.name,error:o[a].reason,uploadId:x()}),r=a.find(e=>!!e?.error);if(r&&!h)throw r.error;(!r||h)&&j(a)})},[C,j,A.isForCuration,A.isForUserReview,A.isAllowedNonLoggedInUpload,A.locationId,A.pid,A.pidAttr,h]),{dragging:Y}=ev(V,F),G=p(()=>({photos:F,photosResultQueue:b,open:$,dragging:Y,progress:R,selectFiles:V,uploadFiles:q,addPhotosUploadedCallback:k,removePhotosUploadedCallback:Z}),[F,b,$,Y,R,k,V,Z,q]);return r(el.Provider,{value:G,children:[e,a("input",{ref:T,type:"file",multiple:!A?.maxAllowedFiles||A.maxAllowedFiles>1,accept:A.allowedFileTypes.join(","),style:{display:"none"},onChange:e=>{e.preventDefault(),V(e.currentTarget.files?[...e.currentTarget.files].filter(Boolean):[]),e.currentTarget.value=""},"aria-hidden":!0,tabIndex:-1})]})},ek=e=>{var{addPhotosUploadedCallback:o,removePhotosUploadedCallback:a,...r}=s(el),i=d(e);return i.current=e,n(()=>{if(null==i.current)return()=>{};var e=(e,o)=>!!i.current&&i.current(e,o);return o(e),()=>{a(e)}},[o,a]),r},eZ=(e,o,a=e=>e)=>{var t=e.match(o);return t?.index!=null?r(i,{children:[e.substring(0,t.index),a(t[1]||t[0]),e.substring(t.index+t[0].length)]}):e},e$={dropZone:"wWxsJ e u j c z _E B2 BC",small:"GLyFA",large:"OlQdl",fileInput:"bAYEn Xd",disabled:"AxRyl",dragging:"kQZzc",cosmeticButton:"ViJpi Rd _S",cosmeticBorderlessButton:"GOYkZ Wd _S",keyboardMode:"kIOnU",touchOnly:"tMKCA",mouseOnly:"lVrpX"},ez=({plural:e})=>e?a(g,{id:"post_photo_upload_photos_button"}):a(g,{id:"confirmed_booker_upload_photo"}),eB=({variant:e="large",dragging:o,disabled:i,allowedFileTypes:t=[],onFileSelected:l,mediaType:d,multiple:n=!1,...s})=>{var p=B(),{localize:u}=v();return r("label",{className:W(e$.dropZone,j(s),{[e$.small]:"small"===e,[e$.large]:"large"===e,[e$.dragging]:!i&&o,[e$.disabled]:i,[e$.keyboardMode]:p}),children:[a("input",{type:"file",multiple:n,accept:t.join(","),disabled:i,className:e$.fileInput,onChange:l,tabIndex:i?-1:0}),"small"===e&&r(z,{variant:"supporting-01",children:[a("span",{className:e$.mouseOnly,children:en("video"===d?u.string("post_video_upload_another_video"):u.string("post_photo_upload_another_video"),/<\/> <span class="{sColorClass1}">(.*)<\/span>/,e=>a("span",{className:e$.cosmeticBorderlessButton,children:e}))}),a("span",{className:W(e$.touchOnly,e$.cosmeticBorderlessButton),children:"video"===d?a(g,{id:"add_more_videos_mw_uploader"}):a(g,{id:"add_more_photos_mw_uploader"})})]}),"large"===e&&r("div",{children:[a(z,{variant:"button-01",marginY:"spacing-03",children:a("div",{className:e$.cosmeticButton,children:"video"===d?a(g,{id:"add_more_videos_mw_uploader"}):a(es,{plural:n})})}),r("div",{className:e$.mouseOnly,"aria-hidden":!0,children:[a(z,{variant:"supporting-01",marginY:"spacing-03",children:a(g,{id:"post_photo_or_just_text"})}),a(z,{variant:"title-05",marginY:"spacing-03",children:a(g,{id:"post_photo_drag_and_drop_from_desktop"})})]})]})]})},eW=({multipleMedia:e,mediaType:o,...r})=>{var i,{localize:t}=v();return i=e?"video"===o?t.string("new_videos_terms_of_use"):t.string("new_photos_terms_of_use"):"video"===o?t.string("new_video_terms_of_use"):t.string("new_photo_terms_of_use"),a("div",{className:W("yNxWj",j(r)),children:a(z,{variant:"supporting-01",elementType:"span",children:en(i,/<a .*>(.*)<\/a>/,e=>a(q,{theme:"inline",href:"/pages/terms.html",target:"_blank",children:e}))})})},ej=({mediaType:e,maxAllowedFiles:o,allowedFileTypes:i,maxFileSize:t,...l})=>{var{localize:d}=v(),n=T(),s="video"===e,p=`${d.string("mobile_help_center_url")}${s?"/articles/360024933773-Video-Guidelines":"/articles/200615067"}`,u=o>1?a(g,{id:"post_photo_tips_guidelines"}):null;return r("div",{className:j(l),children:[a(z,{variant:"title-05",marginBottom:"spacing-02",children:a(g,{id:"flash_uploader_tips_and_guidelines_10d8"})}),r("ul",{children:[a("li",{children:a(z,{variant:"supporting-02",marginY:"spacing-01",children:s?a(g,{id:"video_upload_max_number",args:{nVideos:o}}):u})}),a("li",{children:a(z,{variant:"supporting-02",marginY:"spacing-01",children:s?a(g,{id:"video_upload_video_formats_accepted",args:{sFileExtentions:i.join(" ")}}):a(g,{id:"post_photo_accepted_formats"})})}),a("li",{children:a(z,{variant:"supporting-02",marginY:"spacing-01",children:a(g,{id:"file_size_limit_photo",args:{0:t/1024/1024}})})})]}),a(z,{variant:"supporting-02",marginTop:"spacing-03",marginBottom:"spacing-05",children:en(s?d.string("video_upload_more_info_guidelines_link"):d.string("post_photo_more_info_2"),/<span>(.*)<\/span>/,e=>a(q,{theme:"inline",href:p,onClick:()=>{s||n({PhotoUploadFlow:{photoUploadWeb:{action:"guidelinesClick"}}})},target:"_blank",children:e}))})]})},eq={mediaUploadItem:"Cmrpl",withMetadata:"KZHqm",preview:"NxRph",mediaWrapper:"hakMy",media:"ONDNs _R Gp w",deleteButton:"RAxBx",progress:"WBEFN",metadata:"wvYam",locationSelector:"FrvbG"},eV=({media:e,index:o,mediaCount:i,withMetadata:d=!0,isForCuration:s=!1,hasPresetLocation:u=!1,progress:c,onChange:m,onDelete:h})=>{var{localize:I}=v(),[_,f]=l(!1),[U,T]=l(!1),A=p(()=>URL.createObjectURL(e.file),[e.file]);n(()=>()=>URL.revokeObjectURL(A),[A]);var[w,F]=l(null),P=t(()=>h&&h(o),[h,o]),L=t(a=>{f(!1),m(o,{...e,description:a.currentTarget.value})},[o,e,m]),b=t(a=>{F(a),T(!0),m(o,{...e,locationId:a?.locationId})},[o,e,m]),E=t(()=>{F(null),T(!1),m(o,{...e,locationId:null})},[o,e,m]),N=_&&!e.description?a(g,{id:"uploader_error_required_field"}):null,O=U&&(null==e.locationId||e.locationId<=0)?a(g,{id:"uploader_error_required_field"}):null,x=null!=c,D="video"===e.mediaType?a(g,{id:"post_video_video_count_text",args:{nCurrentVideoCount:o+1,nTotalVideoCount:i}}):a(g,{id:"post_photo_video_count_text",args:{nCurrentphotoCount:o+1,nTotalphotoCount:i}});return r("div",{className:W(eq.mediaUploadItem,{[eq.withMetadata]:d}),children:[r("div",{className:eq.preview,children:[i>1&&a(z,{variant:"title-05",marginBottom:"spacing-02",children:D}),r("div",{className:eq.mediaWrapper,children:["photo"===e.mediaType&&a("img",{className:eq.media,src:A,alt:""}),"video"===e.mediaType&&r("video",{controls:!0,controlsList:"nodownload nofullscreen",className:eq.media,children:[a("track",{default:!0,kind:"captions"}),a("source",{src:A,type:"video/mp4"})]}),!x&&a("div",{className:eq.deleteButton,children:a(y,{size:"small",variant:"dark",icon:Y,"aria-label":I.string("mobile_delete"),onClick:P})}),null!=c&&a("div",{className:eq.progress,children:a(G,{numSteps:e.file.size,currentStep:c})})]})]}),d&&r("div",{className:eq.metadata,children:[a(H,{id:`media-upload-description-${o}`,variant:"five-line",label:a(z,{variant:"title-05",children:a(g,{id:"post_photo_add_description_v2_part_1"})}),placeholder:"video"===e.mediaType?I.string("post_video_add_description_v2_part_2"):I.string("post_photo_add_description_v2_part_2"),maxLength:500,characterCountType:N?void 0:"max",required:!0,value:e.description,state:x?"disabled":N?"error":"enabled",errorText:N,onChange:L,onBlur:()=>f(!0),marginBottom:"spacing-03"}),!s&&!u&&a("div",{className:eq.locationSelector,children:null==w?a(V,{size:"small",errorText:O,placeholder:I.string("photo_uploader_add_a_location_tag"),onTextInputChanged:()=>T(!1),onBlur:()=>T(!0),onSelect:b}):a(y,{size:"small",variant:"dark",icon:Y,textPosition:"lead","aria-label":`${w.searchText}. ${I.string("remove_location_cf6")}`,disabled:x,onClick:E,children:w.title})})]})]})},eY=({locationId:e=-1})=>{var[o]=s(_),l=$(),d={...ei,locationId:e},{media:p,error:u,dragging:m,uploading:h,progress:I,canAddMore:v,canSubmit:U,onFileSelected:T,onMediaChanged:A,onMediaDeleted:w,onSubmit:F,resetMediaState:P}=eE(d),L=p.length>0,E=p.length>1;n(()=>{-1===e&&P()},[P,e]);var y=t(()=>{l({}).then(()=>{F().then(e=>{null!=e&&(P(),o({node:a(f,{children:a(g,{id:"success_repost_photo"})})}))})})},[F,o,P,l]),N=E?a(g,{id:"ugc_uploader_photo_v3"}):a(g,{id:"ugc_uploader_photo_v2"});return r(i,{children:[v&&a(ep,{variant:L?"small":"large",dragging:m,disabled:h||-1===e,onFileSelected:T,marginBottom:"spacing-05",mediaType:d.mediaType,multiple:!0}),null!=u&&a(z,{variant:"supporting-01",color:"dangerText",marginY:"spacing-05",children:u}),p.map((e,o)=>a(c,{children:a(em,{media:e,index:o,mediaCount:p.length,withMetadata:d.withMetadata,isForCuration:d.isForCuration,hasPresetLocation:null!=d.locationId&&d.locationId>0,progress:h&&null!=I?I[o]:void 0,onChange:A,onDelete:w})},`${e.file.name}/${e.file.size}`)),L?r(i,{children:[a(eu,{multipleMedia:E,mediaType:d.mediaType,marginTop:"spacing-05",marginBottom:"spacing-03"}),a(b,{variant:"primary",size:"medium",disabled:!U,onClick:y,children:N})]}):a(ec,{mediaType:d.mediaType,maxAllowedFiles:d.maxAllowedFiles,allowedFileTypes:d.allowedFileTypes,maxFileSize:d.maxFileSize,marginTop:"spacing-05"})]})},eG=({onUploadSuccess:e,onUploadCanceled:o,...l})=>{var d={...et,...l},{media:n,error:s,dragging:p,uploading:u,progress:m,canAddMore:h,canSubmit:I,onFileSelected:v,onMediaChanged:_,onMediaDeleted:f,onSubmit:U}=eE(d),T=n.length>0,A=n.length>1,w=t(()=>{U().then(o=>{null!=e&&null!=o&&e(o)})},[U,e]);return r(i,{children:[h&&a(ep,{variant:"large",dragging:p,disabled:u,onFileSelected:v,marginBottom:"spacing-05",mediaType:d.mediaType}),null!=s&&a(z,{variant:"supporting-01",color:"dangerText",marginY:"spacing-05",children:s}),n.map((e,o)=>a(c,{children:a(em,{media:e,index:o,mediaCount:n.length,withMetadata:d.withMetadata,isForCuration:d.isForCuration,hasPresetLocation:null!=d.locationId&&d.locationId>0,progress:u&&null!=m?m[o]:void 0,onChange:_,onDelete:f})},`${e.file.name}/${e.file.size}`)),T?r(i,{children:[a(eu,{multipleMedia:A,mediaType:d.mediaType,marginTop:"spacing-05",marginBottom:"spacing-03"}),a(b,{variant:"primary",size:"medium",disabled:!I,onClick:w,children:a(g,{id:"b2b_media_upload_text"})})]}):a(ec,{mediaType:d.mediaType,maxAllowedFiles:d.maxAllowedFiles,allowedFileTypes:d.allowedFileTypes,maxFileSize:d.maxFileSize,marginTop:"spacing-05"}),a(b,{variant:"primary",size:"medium",onClick:o,marginLeft:T?"spacing-01":void 0,children:a(g,{id:"mc_plus_cancel"})})]})},eH=(e=Object.freeze({}))=>{var o=T(),{login:r}=U(),[i]=s(_),l=d(()=>{}),{open:n}=I(({close:o})=>a(A,{children:a(m,{children:a(eh,{...e,onUploadCanceled:()=>{o(),l.current([])},onUploadSuccess:(...r)=>{o(),i({node:a(f,{children:"video"===e.mediaType?a(g,{id:"success_repost_video"}):a(g,{id:"success_repost_photo"})})}),l.current(...r)}})})}),{},[e,i]);return t(()=>r({flow:"CORE_COMBINED"}).then(()=>(n(),"video"!==e.mediaType&&o({PhotoUploadFlow:{photoUploadWeb:{action:"opened"}}}),new Promise(e=>{l.current=e}))),[r,n,o,e.mediaType])};return[()=>{e("FileSizeError",K=class extends Error{}),e("FileTypeError",J=class extends Error{}),eo=class extends Error{},ea=class extends Error{},er=class extends Error{constructor(e,o){super(),eU(this,"uploaderProgressData",void 0),eU(this,"originalError",void 0),this.uploaderProgressData=e,this.originalError=o}},ei={mediaType:"photo",withMetadata:!0,isForCuration:!1,allowedFileTypes:[".jpg",".jpeg",".gif",".png"],maxFileSize:F,maxAllowedFiles:10,locationId:-1},et={mediaType:"video",withMetadata:!0,isForCuration:!1,allowedFileTypes:[".mp4",".m4v",".mov"],maxFileSize:P,maxAllowedFiles:5,locationId:-1},X=class extends Error{},Q=class extends Error{},ee=class extends Error{constructor(e,o){super(),eD(this,"uploaderProgressData",void 0),eD(this,"originalError",void 0),this.uploaderProgressData=e,this.originalError=o}},el=u({photos:[],photosResultQueue:[],open:()=>{},dragging:!1,progress:null,selectFiles:()=>{},uploadFiles:()=>{},addPhotosUploadedCallback:()=>{},removePhotosUploadedCallback:()=>{}}),ed={withMetadata:!0,isForCuration:!1,allowedFileTypes:[...ei.allowedFileTypes,...et.allowedFileTypes],maxFileSize:P,locationId:-1},en=eZ,es=ez,ep=eB,eu=eW,ec=ej,em=eV,eh=h(()=>o("vdjnw8")),e({CustomPhotoUploadProvider:eM,D:ep,FileSizeError:K,FileTypeError:J,M:em,PostPhotosUploader:eY,T:eu,VideoUploader:eG,a:ei,b:ec,d:et,u:eE,useCustomPhotoUpload:ek,useMediaUploader:eH})},[e=>(a=e.jsx,r=e.jsxs,i=e.Fragment),e=>(t=e.useCallback,l=e.useState,d=e.useRef,n=e.useEffect,s=e.useContext,p=e.useMemo,u=e.createContext,c=e.Fragment,m=e.Suspense,h=e.lazy),e=>I=e.useVDOMPortal,e=>(g=e.default,v=e.useLocalize),e=>(_=e.Toast,f=e.ToastItem),e=>U=e.default,e=>T=e.useInteractionLogger,e=>A=e.ErrorBoundary,e=>(w=e.fileExtension,F=e.maxImageUploadSizeInBytes,P=e.maxVideoUploadSizeInBytes),e=>L=e.default,e=>(b=e.default,E=e.BorderlessButton,y=e.CircularButton),e=>N=e.useWindow,e=>O=e.useMutation,e=>x=e.uuid,e=>(D=e.useAddAttempt,S=e.WarPhotoCounter,C=e.useMarkAsSuccess,R=e.useMarkAsFailure,M=e.useMarkAsRateLimitedError,k=e.useMarkAsClientAborted,Z=e.useMarkAsClientError),e=>$=e.default,e=>z=e.default,e=>B=e.useKeyboardNavigationMode,e=>W=e.default,e=>j=e.margin,e=>q=e.default,e=>V=e.LocationSelector,e=>Y=e.default,e=>G=e.default,e=>H=e.TextArea]]},["21h32l","o4yt4q","4euaes","7thqz4","tr3542","rdycz1","32pwc7","83pm0d","714tj5","v5ce81","jppfwt","ltllz9","mqwhqn","eww825","27fomg","lchj5q","essqvy","2r4qug","fkji80","gw8uw6","lr6tb6","32kj4i","qkjm8h","qndsds","u3aiot"]]);
