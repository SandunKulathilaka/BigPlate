(this.$WP=this.$WP||[]).push(["739ijb",(e,t)=>{var i,s,a,o,h,r,n,g,l,c,d,p,u,m,v,w,f={canvasWrapper:"HtCGG o",canvas:"ivfSt _Z",cropShadow:"AiZBD S",loadingSpinner:"YTMpS t l _Z f e j S",zoomWrap:"IzUXf f j u",zoomIconSmall:"rnVlJ",zoomIconBig:"NQFVv",zoomSlider:"LwGmP"};function S(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var z=e=>{var{localize:t}=n();return i(w,{...e,localize:t})};return[()=>{w=class extends o{componentDidMount(){if(this.setImage(),this.canvasRef.current){var e=this.canvasRef.current;e.addEventListener("touchstart",this.touchStart,{passive:!1}),e.addEventListener("touchmove",this.touchMove,{passive:!1}),e.addEventListener("touchend",this.touchEnd,{passive:!1}),e.addEventListener("touchcancel",this.touchCancel,{passive:!1})}}componentDidUpdate(e){e.url!==this.props.url?this.setImage():(this.updateCanvas(),this.props.cropImageNow&&this.cropImage())}constructor(e){super(e),S(this,"setImage",()=>{this.props.url&&(this.image=new Image,this.image.onload=this.imageLoaded,this.image.crossOrigin="Anonymous",this.image.src=this.props.url)}),S(this,"canvasRef",h()),S(this,"image",void 0),S(this,"prevTouchPositions",new Map),S(this,"pinchInProgress",!1),S(this,"cropImage",()=>{if(this.image){var{cropCenter:e,cropSize:t,zoomCurrent:i}=this.state,s=Math.round(e.x-t.width/2/i),a=Math.round(e.y-t.height/2/i),o=Math.round(t.width/i),h=Math.round(t.height/i),r={x:s,y:a,cropWidth:o,cropHeight:h,originalImageHeight:this.image.height,originalImageWidth:this.image.width},{url:n,mimeType:g,cropImageCallback:l}=this.props;u(n,p(this.image,g,s,a,o,h),g,null,e=>{l({dataUrl:e,cropParams:r})})}}),S(this,"imageLoaded",()=>{if(!this.canvasRef.current||!this.image)throw Error("Image loaded, but refs are not set.  Should not be able to get here.");var e=new c(this.image.width,this.image.height);this.setState({imageLoaded:!0,imageSize:e})}),S(this,"calculateCropSizeAndZoom",()=>{if(!this.canvasRef.current||!this.image)throw Error("Image loaded, but refs are not set.  Should not be able to get here.");var e,t=this.canvasRef.current,{cropWidth:i,cropHeight:s,imageFitDirection:a}=this.props,o=0===i?t.clientWidth:i,h=0===s?t.clientHeight:s,r=new c(o,h),n=r.width/this.image.width,g=r.height/this.image.height;e="horizontal"===a?n:"vertical"===a?g:Math.max(n,g),this.image.height*e<r.height&&(e=g);var{imageSize:l}=this.state;return{cropSize:r,zoom:e,cropCenter:new d(l.width/2,l.height/2)}}),S(this,"updateCanvas",()=>{var{canvasSize:e,imageSize:t,cropCenter:i,zoomCurrent:s}=this.state;if(this.state.imageLoaded&&this.canvasRef.current&&this.image){var a=this.canvasRef.current,o=new c(a.clientWidth,a.clientHeight);a.width=o.width,a.height=o.height;var h=Math.round(t.width*s),r=Math.round(t.height*s),n={x:o.width/2,y:o.height/2},g=Math.round(n.x-i.x*s),l=Math.round(n.y-i.y*s),d=a.getContext("2d");if(d.clearRect(0,0,o.width,o.height),d.drawImage(this.image,g,l,h,r),!e.equals(o)){var p=this.calculateCropSizeAndZoom();this.setState({canvasSize:o,cropSize:p.cropSize,zoomMin:p.zoom,zoomCurrent:p.zoom,cropCenter:p.cropCenter,zoomSliderValue:0})}}}),S(this,"mouseDown",e=>{this.props.enabled&&(e.preventDefault(),this.setState({isDragging:!0,prevPointerPosition:new d(e.pageX,e.pageY)}))}),S(this,"stopDragging",()=>{this.setState({isDragging:!1})}),S(this,"mouseMove",e=>{if(this.state.isDragging&&this.props.enabled){e.preventDefault();var{prevPointerPosition:t}=this.state,i=e.pageX-t.x,s=e.pageY-t.y;this.dragImage(i,s),this.setState({prevPointerPosition:new d(e.pageX,e.pageY)})}}),S(this,"touchStart",e=>{this.props.enabled&&(e.preventDefault(),1===e.touches.length?this.saveSingleTouchPosition(e):2===e.touches.length&&(this.saveTouches(e),this.pinchInProgress=!0))}),S(this,"touchMove",e=>{this.props.enabled&&(e.preventDefault(),1===e.touches.length?this.touchDrag(e):2===e.touches.length&&this.props.allowZoom&&this.handlePinch(e))}),S(this,"saveSingleTouchPosition",e=>{var t=e.touches[0];this.setState({prevPointerPosition:new d(t.pageX,t.pageY)})}),S(this,"touchDrag",e=>{var t=e.touches[0],{prevPointerPosition:i}=this.state,s=t.pageX-i.x,a=t.pageY-i.y;this.dragImage(s,a),this.saveSingleTouchPosition(e)}),S(this,"touchEnd",e=>{e.preventDefault(),1===e.touches.length&&this.saveSingleTouchPosition(e),1!==e.touches.length&&this.stopDragging(),2!==e.touches.length&&(this.pinchInProgress=!1)}),S(this,"touchCancel",()=>{this.stopDragging(),this.pinchInProgress=!1}),S(this,"handlePinch",e=>{var t=e.touches[0],i=e.touches[1],s=new d(t.pageX,t.pageY),a=new d(i.pageX,i.pageY),o=this.prevTouchPositions.get(t.identifier),h=this.prevTouchPositions.get(i.identifier);if(o&&h){var r=s.distanceFrom(a),n=o.distanceFrom(h);if(n>0){var{zoomCurrent:g,zoomMin:l,zoomMax:c,cropCenter:p}=this.state,u=g+(r-n)/n*g;u=m(u,l,c);var v=this.zoomToSliderValue(u),w=this.adjustPointToKeepCropAreaFilled(p,u);this.setState({zoomCurrent:u,cropCenter:w,zoomSliderValue:v}),this.saveTouches(e)}}}),S(this,"saveTouches",e=>{Array.from(e.touches).forEach(e=>this.prevTouchPositions.set(e.identifier,new d(e.pageX,e.pageY)))}),S(this,"dragImage",(e,t)=>{var{cropCenter:i,zoomCurrent:s}=this.state,a=e/s,o=t/s,h=new d(i.x-a,i.y-o),r=this.adjustPointToKeepCropAreaFilled(h,s);this.setState({cropCenter:r})}),S(this,"adjustPointToKeepCropAreaFilled",(e,t)=>{var{cropSize:i,imageSize:s}=this.state,a=new d(e.x,e.y),o=i.width/2/t,h=s.width-o,r=i.height/2/t,n=s.height-r;return a.x=m(a.x,o,h),a.y=m(a.y,r,n),a}),S(this,"zoomIncrement",()=>{var{zoomMin:e,zoomMax:t}=this.state;return(t-e)/100}),S(this,"sliderValueToZoom",e=>this.state.zoomMin+this.zoomIncrement()*e),S(this,"zoomToSliderValue",e=>(e-this.state.zoomMin)/this.zoomIncrement()),S(this,"sliderChanged",(e,t)=>{if(!this.pinchInProgress){var i=this.sliderValueToZoom(t),{cropCenter:s}=this.state,a=this.adjustPointToKeepCropAreaFilled(s,i);this.setState({zoomSliderValue:t,zoomCurrent:i,cropCenter:a})}}),S(this,"render",()=>{var{cropShape:e,width:t,height:o}=this.props,{canvasSize:h,cropSize:n}=this.state,c={width:n.width,height:n.height,top:(h.height-n.height)/2,left:(h.width-n.width)/2,borderRadius:"rectangle"===e?"0%":"100%"},d=this.state.imageLoaded?i("div",{style:c,className:f.cropShadow}):null,p=this.state.imageLoaded?null:i("div",{className:f.loadingSpinner,children:i(v,{size:"large"})}),u=this.props.allowZoom?s("div",{className:f.zoomWrap,children:[i("span",{className:r("ui_icon","photo",f.zoomIconSmall)}),i("div",{className:f.zoomSlider,children:i(g,{min:0,max:99,maxHandleData:{currentValue:this.state.zoomSliderValue,valueDescription:this.props.localize.string("sng_a11y_zoom_level")},currentRangeLabel:null,step:1,onChange:this.sliderChanged})}),i("span",{className:`ui_icon photo ${f.zoomIconBig}`})]}):null;return s(a,{children:[s("div",{style:{width:t,height:o},className:f.canvasWrapper,children:[i("canvas",{className:f.canvas,ref:this.canvasRef,onMouseDown:this.mouseDown,onMouseUp:this.stopDragging,onMouseOut:this.stopDragging,onBlur:this.stopDragging,onMouseMove:this.mouseMove}),d,p]}),u,i(l,{callback:this.updateCanvas})]})}),this.state={canvasSize:new c(0,0),cropSize:new c(0,0),imageLoaded:!1,imageSize:new c(0,0),cropCenter:new d(0,0),zoomMin:1,zoomMax:1,zoomCurrent:1,isDragging:!1,prevPointerPosition:new d(0,0),zoomSliderValue:0}}},e("Cropper",z)},[e=>(i=e.jsx,s=e.jsxs,a=e.Fragment),e=>(o=e.Component,h=e.createRef),e=>r=e.default,e=>n=e.useLocalize,e=>g=e.default,e=>l=e.default,e=>(c=e.Dimension,d=e.Point,p=e.cropImageToJpegUrl,u=e.restoreExifAndRotateIfNeeded,m=e.boundNumber),e=>v=e.LoadingSpinner]]},["21h32l","o4yt4q","fkji80","7thqz4","bljygq","d6vj30","7l6raj","l9qeu7"]]);
