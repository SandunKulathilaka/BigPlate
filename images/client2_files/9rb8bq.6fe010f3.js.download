(this.$WP=this.$WP||[]).push(["9rb8bq",(e,t)=>{var i,r,a,o,n,s,l,d,p,c,u,v,T,m,C,I,S,E,b,f,h,g,k,y,_,A,O,M,R,L,w,D,N,P,j,x,V,F,U,q={__key:0x89e8eb1fd52f,id:"89e8eb1fd52fb9f3",loc:{},definitions:[]},z=(e,t)=>{if(!t)return e;var i=e.paginatedTrips?.trips||[],r=t.paginatedTrips?.trips||[];return{paginatedTrips:e.paginatedTrips?{trips:[...i,...r],hasMore:!!t.paginatedTrips?.hasMore,__typename:e.paginatedTrips.__typename}:t.paginatedTrips,savedTrips:e.savedTrips}},G=e=>({__typename:"Trip",id:e.id||0,title:e.title||void 0,status:e.status?.toUpperCase()||void 0,photoId:e.photo&&"id"in e.photo?e.photo.id:void 0,photo:e.photo||{},date:e.date?{from:e.date.from??void 0,to:e.date.to??void 0,type:e.date.type??void 0,duration:e.date.duration??0}:void 0,route:{url:e.route&&e.route.url||void 0},actionPermissions:{canAddItem:!!e.actionPermissions?.canAddItem},tripLocations:e.tripLocations||[]}),W=e=>{var t=(t,i)=>{if(!t||!i)return"invalidateAndRefetch";var{originalObject:r}=e;return r&&i===r.type&&t===String(r.id)||i===e.type&&t===String(e.id)?"invalidateAndRefetch":"validate"},i=b(),r=u(e),[a,o]=R({query:q,variables:{offset:0,limit:10,userId:i||"",referenceId:r.id,referenceType:r.type,loadSavedTrips:!0},combineData:z,showFetchingAfterFirstQuery:!0,invalidationPredicates:{createTrip:()=>"invalidateAndRefetch",cloneTrip:()=>"invalidateAndRefetch",tripsDelete:()=>"invalidateAndRefetch",addItemToTrip:({variables:{referenceId:e,referenceType:i}})=>t(e,i),Trips_moveTripItems:({variables:{reference:e}})=>t(e?.id,e?.type),tripsRemoveItem:({variables:{reference:e}})=>t(e?.id,e?.type),tripsRemoveReference:({variables:{reference:e}})=>t(e?.id,e?.type),Trips_copyTripItem:({variables:{reference:e}})=>t(e?.id,e?.type)}}),n=a.data?.paginatedTrips?.trips||[],s=n.slice().filter(Boolean).map(G),l=!!a.data?.paginatedTrips?.hasMore,d=a.data?.savedTrips||[],p=new Set(d.map(e=>e?.id).filter(Boolean));return{fetching:a.fetching,error:!!a.error,data:{tripList:s,saveSet:p},hasMore:l,loadMore:l?()=>o({offset:n?.length||0,loadSavedTrips:!1}):()=>Promise.resolve()}},B={DEFAULT:e=>"bundleSave"!==e?i(_,{id:"stat_modal_save_to_trip_v2"}):i(_,{id:"save_all_items_modal_header"}),CREATE:()=>i(_,{id:"stat_modal_create_a_trip_v2"}),SELECT:()=>i(_,{id:"select_trip_header"}),SELECT_CREATE:()=>i(_,{id:"stat_modal_create_a_trip_v2"})},Q=({saveObject:e,initialTripTitle:t,overlayState:r,validateTripName:s,lastSavedItem:d,trackingContext:p,trackingSource:c,sourceTripId:u,tripItemId:T,additionalItemReferences:m,showPlacesToStay:C,...I})=>{var S,[E,b]=a(!0),{fetching:f,error:h,data:_,hasMore:R,loadMore:L}=w(e);f?S=i(y,{size:"large"}):h&&(S=i(O,{refetch:L}));var x="gaiTrip"===e.type,V="publicTripBundle"===e.type,F=x?"COPY":"SAVE";o(()=>{f||b(!1)},[f]);var[U]=l({source:c||"trips",trackingContext:p,pageAsContext:!0,withSaveSession:!0}),q=()=>{I.onClose(),b(!0)},z=B[r](e.type),G=e=>i(k,{widthOption:"fixed-40",heightOption:"restricted",roundCorners:!0,title:z,stickyFooter:!1,onClose:q,children:i("div",{className:"tvfpI",children:e})}),W=G(i(y,{size:"large"})),Q=e=>{e.target===e.currentTarget&&q()};return i(A,{element:"bundleSave"===e.type?"copyTripModal":"saveTripModal",children:i(g,{className:"MmndE D t _U s l Za f",onClose:q,onMouseDown:Q,onTouchStart:Q,onClick:e=>{e.stopPropagation()},children:i("div",{className:"tubFl f _Y e",children:S&&E?G(S):(()=>{var a=d?v(d):void 0,o=()=>x||V?i(M,{children:i(n,{fallback:W,children:i(P,{title:z,onClose:q,onCreateTripInputChange:I.onCreateTripInputChange,gate:()=>Promise.resolve(),object:e,additionalItemReferences:m,initialTripTitle:t,onMount:()=>{f||h||U({elementClick:{element:"createTrip"}})},onAddedToCreatedTrip:e=>{I.statCallback("ADD","NEW",e,!0,!0),q()},validateTripName:s,trackingContext:p,trackingSource:c,showPlacesToStay:C})})}):i(M,{children:i(n,{fallback:W,children:i(D,{title:z,onClose:q,gate:()=>Promise.resolve(),object:e,onMount:()=>{f||h||U({elementClick:{element:"createTrip"}})},onAddedToCreatedTrip:e=>{I.statCallback("ADD","NEW",e,!0,!0),q()},onError:I.onError,validateTripName:s,trackingContext:p,trackingSource:c,sourceTripId:u,tripItemId:T,additionalItemReferences:m})})});switch(r){case"DEFAULT":return 0===_.tripList.length?o():i(M,{children:i(n,{fallback:W,children:i(j,{title:z,onClose:q,tripList:_.tripList,savedSet:_.saveSet,tripListBottom:S,onPaginate:L,hasMore:R,saveObject:e,onMount:()=>{I.preventInteractionInMountedComponents||U({elementClick:{element:"stat"}})},onCreateTrip:()=>{I.onCreateTripClicked&&I.onCreateTripClicked()},tripAction:F,onRemovedFromTrip:(e,t,i)=>{I.statCallback("REMOVE","EXISTING",e,t,i),q()},onSavedToTrip:(e,t,i)=>{I.statCallback("ADD","EXISTING",e,t,i),q()},onSaveToTripClick:(e,t,i)=>{I.statCallback("CLICK","EXISTING",e,t,i)},onError:I.onError,trackingContext:p,trackingSource:c,sourceTripId:u,tripItemId:T,additionalItemReferences:m})})});case"CREATE":return o();case"SELECT":if(a)return i(M,{children:i(n,{fallback:W,children:i(j,{title:z,onClose:q,tripList:_.tripList,savedSet:_.saveSet,tripListBottom:S,onPaginate:L,hasMore:R,saveObject:a,onMount:()=>{U({elementClick:{element:"stat"}})},onCreateTrip:()=>{I.onSelectCreateTripClicked&&I.onSelectCreateTripClicked()},tripAction:"MOVE",onMovedToTrip:(e,t,i)=>{I.statCallback("MOVE","EXISTING",e,t,i),q()},onRemovedFromTrip:(e,t,i)=>{I.statCallback("REMOVE","EXISTING",e,t,i),q()},onError:I.onError,trackingContext:p,trackingSource:c,sourceTripId:u,tripItemId:T,additionalItemReferences:m})})});return"";case"SELECT_CREATE":if(d)return i(M,{children:i(n,{fallback:W,children:i(N,{title:z,onClose:q,gate:()=>Promise.resolve(),item:d,onMovedToCreatedTrip:e=>{I.statCallback("MOVE","NEW",e,!0,!0),q()}})})});return o();default:return""}})()})})})},X=e=>{},$=(e,t)=>{switch(t.type){case"setOverlayState":return{...e,overlayState:t.state??e.overlayState};case"afterSave":return{...e,overlayState:"DEFAULT",preventInteractionInMountedComponents:!0};default:throw Error()}},Y=({allowPopStatModal:e,logInteraction:t,puid:a,object:o,active:n,initialTripTitle:s,preventInteractionPropagation:l,trackingContext:d,trackingSource:c,resaveTrip:u,saveObject:v,saveStatus:T,updateLastTripId:C,onClose:I=()=>{},initialOverlayState:S,onViewTripToastVisible:E,viewTripOpensNewTab:h,tripItemId:g,sourceTripId:k,additionalItemReferences:y,showPlacesToStay:_,...A})=>{var O=b(),{launchViewTripToast:M,launchRemoveFromTripToast:R,launchErrorTripToast:L}=m(),{getTripErrorMessage:w}=f(),D=r.useContext(p),[N,P]=r.useReducer($,{overlayState:S||"DEFAULT",preventInteractionInMountedComponents:!1}),{onComplete:j}=A,V=r.useCallback((e,t,i,r,a)=>{j&&j(e,t,i,r,a),D.resetSession()},[j,D]),F=r.useCallback((e,i)=>{e&&!i?(M({trip:e,messageType:"SAVED",onCtaClick:()=>{t({elementClick:{element:"saved_viewTrip"}})}}),V(!0,"SAVED")):i&&(L(i),V(!1)),P({type:"setOverlayState",state:"DEFAULT"}),t({elementClick:{element:"unsave_undo"}})},[M,V,L,t]),U=r.useCallback(e=>{R(e,v,F)},[R,F,v]),q=r.useCallback(e=>{L(e)},[L]),[z,G]=r.useState(!1),W=r.useCallback(()=>{G(!0),D.resetSession(),I()},[D,I]),B=r.useCallback((e,i,r)=>{P({type:"afterSave"}),M({trip:e,messageType:i,onCtaClick:()=>{t({elementClick:{element:"saved_viewTrip"}})},onVisible:()=>E?.(i,e.id),openTripInNewTab:h}),C(e.id),V(!0,i,e.id,e.title,r)},[M,C,V,t,E,h]);return z?null:i("div",{role:"presentation",className:"stat_wrapper",onClick:e=>{e.stopPropagation(),e.preventDefault(),!l&&O&&t({elementClick:{element:"item_save",tripId:u?.id}})},children:i(x,{onCreateTripInputChange:A.onCreateTripInputChange,saveObject:v,additionalItemReferences:y,initialTripTitle:s,overlayState:N.overlayState,lastSavedItem:T.result?.tripItem,trackingContext:d,trackingSource:c,onCreateTripClicked:()=>{P({type:"setOverlayState",state:"CREATE"})},onSelectCreateTripClicked:()=>{P({type:"setOverlayState",state:"SELECT_CREATE"})},onClose:W,onError:q,preventInteractionInMountedComponents:N.preventInteractionInMountedComponents,statCallback:(e,t,i,r,a=!1)=>{i&&"id"in i&&("REMOVE"===e?(U(i),V(a)):"NEW"===t?B(i,"CREATED",Number(v.id)):"CLICK"===e&&"EXISTING"===t?A?.onItemClick?.(i.id,i.title):r&&B(i,"SAVED",Number(v.id)))},validateTripName:e=>{if("bundleSave"===v.type&&e.trim().toLowerCase()===o?.title?.trim().toLowerCase())return w("COPY_TRIP",{type:"INVALID_VALUE",field:"TITLE"})},tripItemId:g,sourceTripId:k,showPlacesToStay:_})})},H=e=>i(d,{children:i(h,{children:i(Y,{...e})})}),K=["Profile","HomeFeed","Trips","Home"],Z=e=>{var t=r.useMemo(()=>e.saveObject||v(e.object,!0),[e.saveObject,e.object]),{resaveTrip:a,onComplete:o,allowPopStatModal:n,flowOrigin:s,onAutosavedToTripToastVisible:d}=e,{isNativeWebview:u,tripId:T,tripItemId:b,sourceTripId:f,...h}=e,{launchAutoSavedToTripToast:g,launchErrorTripToast:k}=m({saveToast:e.saveToast}),y=C(),{page:_}=y,[A,O]=l(r.useMemo(()=>({source:e.trackingSource||"trips",saveObject:t,trackingContext:e.trackingContext,withSaveSession:!0,pageAsContext:!0}),[e.trackingContext,e.trackingSource,t])),M=r.useContext(p),[R,L,w]=I({selectedTripId:T,object:t,isActive:e.active,tripItemId:b,sourceTripId:f}),D=t?.id,N=t?.type,P=r.useCallback(e=>{k(e)},[k]),j=r.useCallback(()=>{A({elementClick:{element:"ITEM_SAVE_LOGIN",context:_?c(_):void 0,puid:O,saveType:N,detailId:D?`${D}`:"",tripId:a?.id,sessionType:"SAVE",sessionUuid:M.sessionUuid,sessionOrder:M.sessionOrder}})},[A,_,O,a,D,N,M.sessionOrder,M.sessionUuid]),x=r.useCallback(()=>{sessionStorage.setItem("DELEGATE_RELOAD","true"),A({modalSuccess:{element:"ITEM_SAVE_LOGIN",context:_&&c(_)||void 0,puid:O,saveType:N,detailId:D?`${D}`:"",tripId:a?.id,sessionType:"SAVE",sessionUuid:M.sessionUuid,sessionOrder:M.sessionOrder}})},[A,_,O,a,D,N,M.sessionOrder,M.sessionUuid]),F=S(r.useMemo(()=>({pid:_&&K.includes(y.page)?40439:39766,flow:u?"NATIVE_LOGIN":"SAVES_COMBINED",flowOrigin:s,onLogin:j,onSuccess:x,isFullWidthMobile:!0}),[j,x,_,y.page,u,s])),U=r.useRef(!1),{open:q}=E(()=>t?i(V,{...h,logInteraction:A,puid:O,initialTripTitle:e.initialTripTitle,saveObject:t,saveStatus:R,updateLastTripId:w,viewTripOpensNewTab:e.viewTripOpensNewTab,sourceTripId:f,tripItemId:b,additionalItemReferences:e.additionalItemReferences,onClose:()=>{sessionStorage.getItem("DELEGATE_RELOAD")&&(sessionStorage.removeItem("DELEGATE_RELOAD"),window.location.reload())}}):null),{open:z}=E(()=>t?i(V,{...h,initialOverlayState:"SELECT",logInteraction:A,puid:O,saveObject:t,saveStatus:R,updateLastTripId:w,viewTripOpensNewTab:e.viewTripOpensNewTab,sourceTripId:f,tripItemId:b,additionalItemReferences:e.additionalItemReferences}):null),G=!!n&&"popStat"in y.params&&y.params.popStat;return r.useEffect(()=>{G&&!U.current&&(U.current=!0,A({elementClick:{element:"autoPopStat"}}),F().then(q))},[A,F,q,G]),r.useCallback(()=>{F().then(()=>L()).then(([e,t])=>{if(null===e&&null===t){q();return}t?P({query:"ADD_ITEM_TO_TRIP",tripsError:t}):e&&(g(e,()=>{z(),A({elementClick:{element:"quickSave_change"}})},()=>d?.("SAVED",e.id)),A({modalSuccess:{element:"quickSave",tripId:a?.id,context:_&&c(_)||void 0,saveType:N,detailId:D?`${D}`:""}}),o&&o(!0,void 0,e.id,e.title,Number(D)))})},[q,z,d,g,A,F,o,P,L,_,a,D,N])},J=({children:e,...t})=>{var a=r.useMemo(()=>t.saveObject||v(t.object,!0),[t.saveObject,t.object]),o=F(t);return a?i(d,{children:e(o)}):null},ee=({queryObject:e,object:t,children:r,...a})=>{function o(t,i){if(!t||!i)return"invalidateAndRefetch";var{originalObject:r}=e;return r&&i===r.type&&t===String(r.id)||i===e.type&&t===String(e.id)?"invalidateAndRefetch":"validate"}var n=b(),[{fetching:s,data:l}]=L({query:e.query,variables:e.variables,pause:!n},{addItemToTrip:({variables:{referenceId:e,referenceType:t}})=>o(e,t),tripsRemoveItem:({variables:{reference:e}})=>o(e?.id,e?.type),tripsRemoveReference:({variables:{reference:e}})=>o(e.id,e?.type),Trips_copyTrip:({variables:{reference:e}})=>o(e?.id,e?.type),Trips_cloneTrip:({variables:{reference:e}})=>o(e?.id,e?.type),Trips_copyTripItem:({variables:{reference:e}})=>o(e?.id,e?.type),Trips_removeItemReferences:({variables:{reference:e}})=>o(e?.id,e?.type)}),{id:d,socialStatistics:p}=l?.savesObjects?.[0]??t?.object??t??{id:void 0,socialStatistics:void 0},c=!1;return(void 0===d||d===e.id||String(d)===e.id)&&(c=!!p?.isSaved),i(U,{active:c,object:t,...a,children:e=>r(e,c,s)})},et=e=>{var t=e.saveObject||v(e.object,!0);if(!t)return console.error("An invalid saves object was passed to QueriedTripFlowSelector"),null;var r=T(t);return r?i(ee,{...e,queryObject:r}):(console.error("Unsupported saves object was passed to QueriedTripFlowSelector"),null)};return[()=>{w=W,D=s(()=>t("5kzfzt").then(e=>({default:e.CreateTripWithAddItemModal}))),N=s(()=>t("5kzfzt").then(e=>({default:e.CreateTripWithMoveItemModal}))),P=s(()=>t("5kzfzt").then(e=>({default:e.CloneTripWithAddItemModal}))),j=s(()=>t("an5ymg").then(e=>({default:e.SaveToTripContent}))),x=Q,Y.defaultProps={preventInteractionPropagation:!1,onComplete:void 0,trackingContext:void 0,allowPopStatModal:!1},V=H,F=Z,U=J,et.defaultProps={object:null,trackingContext:void 0,allowPopStatModal:!1},e({QueriedTripFlowSelector:et,TripFlowSelector:U,setSTATDisabledForTesting:X})},[e=>i=e.jsx,e=>(r=e,a=e.useState,o=e.useEffect,n=e.Suspense,s=e.lazy),e=>(l=e.useTripInteraction,d=e.SaveSessionProvider,p=e.SaveSessionTrackingContext,c=e.getInteractionsContext),e=>(u=e.toReference,v=e.toSavesObject,T=e.objectStatisticQuery),e=>m=e.default,e=>C=e.useRoute,e=>I=e.useAutosave,e=>S=e.useSocialLoginGate,e=>E=e.useVDOMPortal,e=>b=e.useUserId,e=>f=e.useLocalizeTripError,e=>h=e.ToastProvider,e=>g=e.ModalBase,e=>k=e.ContentContainer,e=>y=e.LoadingSpinner,e=>_=e.default,e=>A=e.TripsImpression,e=>O=e.default,e=>M=e.ErrorBoundary,e=>(R=e.usePaginatedQuery,L=e.useInvalidatableQuery)]]},["21h32l","o4yt4q","k7dpqn","iyqcwg","2wscmt","fgwvq1","uw9rn6","0506zk","4euaes","52far5","mc5s4b","tr3542","uzmmz7","i3sz5h","l9qeu7","7thqz4","665v5s","qhcore","83pm0d","fbuhsy"]]);
