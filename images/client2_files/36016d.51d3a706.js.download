(this.$WP=this.$WP||[]).push(["36016d",(e,o)=>{var t,r,i,n,s,a,u,c,p,d,l,_,m,g,C,E,v,h,D,y,A=()=>{var{localize:e}=g();return n(o=>{switch(o){case"REJECTED_INACTIVE":return e.string("plus_checkout_promo_code_expired");case"REJECTED_CONNECTION_ERROR":return e.string("plus_checkout_promo_code_error");case"REJECTED_INVALID_USER":return e.string("plus_checkout_promo_code_unauthorized");case"REJECTED_ALREADY_USED":return e.string("plus_checkout_promo_code_used");default:return e.string("plus_checkout_promo_code_invalid")}},[e])},T={discountInputContainer:"vhdxv O f"},R=({formFieldPrefix:e="pc",...o})=>{var{localize:_}=g(),{promoCodeForm:C,updatePromoCodeForm:h}=s(l),{appliedPromoCode:D,displayState:A,errorText:f,isApplying:P,promoCodeField:I}=C,O=y(),x=E(),k=n(()=>{x({OptimusDiscountCode:{optimusAction:{pageAction:"click",pageProperty:"promocode_link"}}}),h({displayState:"ShowPromoCodes"})},[h,x]),N=n(e=>h({promoCodeField:{...I,value:e.toUpperCase()}}),[I,h]),S=n(()=>{x({OptimusDiscountCode:{optimusAction:{pageAction:"click",pageProperty:"promocode_apply",discountCode:I.value}}}),h({isApplying:!0})},[h,x,I]),b=n(e=>{x({OptimusDiscountCode:{optimusAction:{pageAction:"in_view",pageProperty:"promocode_error",attribute:e}}})},[x]),{subscriptionPrice:w}=R.useOptimusSubscriptionPrice("CHECKOUT"),{discount:L}=w||{};a(()=>{if(C.isApplying&&L?.discountCode){var{discountCode:e,discountedPrice:o,originalPrice:t,status:r}=L;"APPLIED"===r?h({appliedPromoCode:{amount:o-t,code:e,appliedPrice:w},isApplying:!1,promoCodeField:{...C.promoCodeField,isError:!1,value:""}}):h({appliedPromoCode:null,errorText:O(r),isApplying:!1,promoCodeField:{...C.promoCodeField,isError:!0,value:e}})}},[O,C,L,h,w]);var F=n(e=>O("REJECTED_CONNECTION_ERROR")===e?"connection_error":O("REJECTED_DISCOUNT_SERVICE_ERROR")===e?"invalid_code":O("REJECTED_INVALID_USER")===e?"unauthorized":O("REJECTED_ALREADY_USED")===e?"already_used":O("REJECTED_INACTIVE")===e?"cancelled_expired":"",[O]);return a(()=>{I.isError&&f&&(x({OptimusDiscountCode:{optimusAction:{pageAction:"failed",pageProperty:"promocode"}}}),b(F(f)))},[I,f,x,F,b]),t(p,{...o,children:r(d,{dividers:!0,space:"spacing-03",children:[t(i,{}),"ShowPromoCodes"===A&&!D&&r(p,{display:"flex",className:T.discountInputContainer,children:[t(v,{errorText:I.isError?f:void 0,id:`${e}-promoCodeInput`,marginRight:"spacing-03",onChange:e=>N(e.currentTarget.value),placeholder:_.string("plus_checkout_promo_code_placeholder"),state:I.isError?"error":"enabled",type:"text",value:I.value}),t(u,{dataAttributes:{"data-automation":"applyDiscount"},disabled:P,onClick:()=>I.value&&S(),variant:"secondary",children:t(m,{id:"plus_checkout_promo_code_apply"})})]}),"ShowLink"===A&&t(p,{marginY:"spacing-03",children:t(c,{dataAttributes:{"data-automation":"showDiscountInput"},onClick:k,children:t(m,{id:"plus_checkout_promo_code"})})})]})})};function f(e,o){var t=E(),{updatePromoCodeForm:r}=s(l),i=C(),{localize:a}=g(),u=C(),c=n(()=>{t({OptimusDiscountCode:{optimusAction:{pageAction:"success",pageProperty:"promocode"}}})},[t]),p=e?.discountCode;if(!e||!p)return null;var d=i.formatCurrencyInteger(e.originalPrice),_=e.discountedPrice-e.originalPrice,{expiryDate:m}=e,v=m?u.formatDate("date_short",new Date(m)):null,h=o?a.string("plus_partner_discount_tooltip",{0:o}):a.string("plus_first_year_discount_title"),D=`${a.string("plus_first_year_discount_body",{originalPrice:d})}
  ${v?a.string("plus_discount_expire_date",{expireDate:v}):""}`;return{onRemove:()=>r({appliedPromoCode:null}),price:_,rawPrice:_,title:p,...e.discountedPrice>0?{tooltipTitle:h,tooltipBody:D}:null,variant:"DISCOUNT",onRemoveVisible:c}}var P=()=>{var e="discountCode";return{setDiscountCode:o=>{h.set(e,o,864e5)},getDiscountCode:()=>h.get(e),clearDiscountCode:()=>{h.remove(e)}}},I={__key:78497881041057,id:"4764b650a8a14c46",loc:{},definitions:[]},O={TARGET:{img:"/img2/plus/plus-partner-logo-target.svg",altText:"Target logo"},ACORNS:{img:"/img2/plus/plus-partner-logo-acorns.svg",altText:"Acorns"},CLEAR:{img:"/img2/plus/plus-partner-logo-clear.svg",altText:"Clear"}},x=(e,o)=>{var t=o||!e,[{data:r,fetching:i,error:n}]=D({query:I,variables:{discountCode:e||""},pause:t});if(t)return{partnerName:null,partnerLogo:null,entitlement:null,fetching:!1,error:void 0};var s=r?.partnerEntitlement?.partnerName;return{partnerName:s?O[s]?.altText:void 0,partnerLogo:s?O[s]?.img:void 0,entitlement:r?.partnerEntitlement?.entitlement,error:n,fetching:i}},k={__key:80868459168312,id:"498ca7c842385688",loc:{},definitions:[]},N=e=>{var[{data:o,fetching:t,error:r}]=D({query:k,variables:{discountCode:e||""},pause:!e});if(!e)return{data:null,fetching:!1};if(r)throw TypeError(r.message);return{data:o?.OptimusBenefits_getTermsAndConditionsForDiscountCode?.[0]||null,fetching:t}};return e("useDiscountCharge",f),[()=>{y=A,R.useOptimusSubscriptionPrice=_,e({default:R,useDiscountCharge:f,useDiscountCodePersistance:P,useOptimusEntitlement:x,useTermsAndConditionsForDiscountCode:N})},[e=>(t=e.jsx,r=e.jsxs,i=e.Fragment),e=>(n=e.useCallback,s=e.useContext,a=e.useEffect),e=>(u=e.default,c=e.BorderlessButton),e=>(p=e.Box,d=e.Stack),e=>l=e.Payment,e=>_=e.useOptimusSubscriptionPrice,e=>(m=e.default,g=e.useLocalize,C=e.useIntlFormatter),e=>E=e.useInteractionLogger,e=>v=e.TextInput,e=>h=e.default,e=>D=e.useQuery]]},["21h32l","o4yt4q","jppfwt","lyyh8d","1yajq4","i9ixrv","7thqz4","32pwc7","u3aiot","9b9b10","mqwhqn"]]);
