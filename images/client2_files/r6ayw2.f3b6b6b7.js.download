(this.$WP=this.$WP||[]).push(["r6ayw2",(e,t)=>{var r,o,a,i,s,n,c,u,l,_,d,p,m,g,b,y,I,j={__key:46198138182020,id:"2a04579d998451f1",loc:{},definitions:[]},h=e=>{switch(e.__typename){case"Trips_LocationItemObject":if(e.object?.placeType==="COUNTRY")return e.object?.locationId;if(e.object?.detail?.__typename==="Geo")return e.object?.countryId;return e.object?.parentGeoId;case"Trips_AttractionItemObject":case"Trips_ForumPostItemObject":case"Trips_ReviewItemObject":return e.object?.location?.parentGeoId;default:return null}},f=e=>e?.__typename==="Trips_LocationItemObject",v=e=>e.object?.__typename==="Trips_LocationItemObject"&&e.object?.object?.placeType==="ACCOMMODATION"&&e.object?.object?.accommodationCategory==="HOTEL",T=(e,t)=>{switch(t){case"food_and_drink":return e.string("trips_v2_category_food_and_drink");case"forums":return e.string("trips_v2_category_forums");case"notes":return e.string("trips_v2_category_notes");case"photos_and_videos":return e.string("trips_v2_category_photos_and_videos");case"places_to_see":return e.string("trips_v2_category_places_to_see");case"places_to_go":return e.string("trips_v2_category_places_to_go");case"places_to_stay":return e.string("trips_v2_category_places_to_stay");case"reviews":return e.string("trips_v2_category_reviews");case"things_to_do":return e.string("trips_v2_category_things_to_do");default:return""}},O=e=>{switch(e.__typename){case"Trips_LocationItemObject":return e.object?.locationId;case"Trips_ReviewItemObject":return e.reviewId;case"Trips_LinkPostItemObject":return e.linkPostId;case"Trips_AttractionItemObject":return e.attractionProductId;case"Trips_PhotoItemObject":return e.photoId;case"Trips_VideoItemObject":return e.videoId;case"Trips_NoteItemObject":return e.noteId;case"Trips_ForumPostItemObject":return e.forumPostId;case"Trips_RepostItemObject":return e.repostId;default:return}},w=(e,t)=>{var r=new Date(e);return r.setDate(e.getDate()+t),r},P={__key:61275194274963,id:"37babe3034932e67",loc:{},definitions:[]},z=["places_to_stay","places_to_go","places_to_see","things_to_do","food_and_drink","notes"],k=e=>{var{localize:t}=_(),[a,i]=r([]),[s,n]=r([]),u=o(()=>(e.categorizedItems.find(e=>"photos_and_videos"===e.category)?.items||[]).map(e=>e?.object?.__typename==="Trips_VideoItemObject"&&e.object?.object?.__typename==="Media_VideoResult"||e?.object?.__typename==="Trips_PhotoItemObject"&&e.object?.object?.__typename==="Media_PhotoResult"?e.object?.object?.locationId:null).filter(Boolean),[e.categorizedItems]),[l]=c({query:P,variables:{locationIds:u},pause:!u?.length}),d=o(()=>{var e=new Map;return l?.data?.locations?.forEach(t=>{t?.locationId&&e.set(t.locationId,t)}),e},[l]),p=o(()=>e.tripLocations?.filter(e=>e?.location?.name&&e?.location?.locationId).map(e=>({id:String(e?.location?.locationId||""),label:e?.location?.localizedAdditionalNames?.long||e?.location?.name||""}))||[],[e.tripLocations]),m=o(()=>e.categorizedItems.map(e=>({id:e.category,label:T(t,e.category)}))||[],[e.categorizedItems,t]),g=o(()=>{if(!e.categorizedItems?.length)return[];if(!a.length&&!s.length)return e.categorizedItems;var t=e.categorizedItems.filter(e=>!a.length||a.includes(e.category));return s.length?t.map(e=>e?.category?{category:e.category,items:e?.items?.filter(e=>{if(!e?.object?.object)return!1;var t=h(e.object);return!!t&&s.includes(String(t))})||[]}:null).filter(Boolean):t},[e.categorizedItems,a,s]),b=o(()=>g.reduce((e,t)=>e+t.items.length,0),[g]),y=o(()=>e.categorizedItems.reduce((e,t)=>z.includes(t.category)?e+t.items.length:e,0),[e.categorizedItems]);return{tripSaves:e.categorizedItems,filteredTripSaves:g,filtersCount:a.length+s.length,tripLocations:p,tripCategories:m,categoryFilters:a,locationFilters:s,setCategoryFilters:i,setLocationFilters:n,totalItinerarySavesCount:y,filteredTripSavesCount:b,photoVideoLocationsMap:d}},C=({children:e,tripId:t,userId:r})=>{var a=u(),{localize:n}=_(),l=d(),y=p(),h=b(r),[{data:f,fetching:v,error:T},P]=c({query:j,variables:{tripId:t,currency:l}});i(()=>{r!==h&&P({requestPolicy:"network-only"})},[r,h,P]);var z=f?.Trips_getTrips?.[0];z&&(z.sponsorship=f?.SponsorshipManager_getCurrentSponsorshipByTripByIdAndLocale?.[0]);var[k,C]=o(()=>{var e=new Map,t=new Map;return z?.items?.forEach(r=>{if(r?.id&&r?.object&&e.set(r.id,r.object),r?.object?.object){var o=O(r.object.object);o&&t.set(o,r.object)}}),[e,t]},[z?.items]),M=o(()=>{var e={buckets:[],items:[]};return z?.structure&&(e.items=z?.structure?.items?.map(e=>e&&k.has(e)?k.get(e):null)?.filter(Boolean)||[],e.buckets=z?.structure?.buckets?.map((e,t)=>{var r=n.string("attractions.booking.section.mdtitinerary.day",{0:t+1});if(z?.date?.type==="DATES"&&z?.date?.from){var o=g(z.date.from);r=o?y.formatDate("date_full_month",w(o,t)):r}return e?.id?{id:e?.id,name:r,items:e?.items?.map(e=>e&&k.has(e)?k.get(e):null)?.filter(Boolean)||[]}:null})?.filter(Boolean)||[]),e},[z,k,n,y]),L=o(()=>z&&z.categorizedItems?.reduce((e,t)=>(t&&t?.category&&t?.items?.length&&e.push({category:t.category,items:t?.items?.map(e=>e&&k.has(e)?k.get(e):null)?.filter(Boolean)||[]}),e),[])||[],[z,k]),S=s(()=>a.query(j,{tripId:t,currency:l},{requestPolicy:"network-only"}).toPromise(),[a,t,l]),q=o(()=>({error:T,fetching:!z&&v,refetch:S,trip:z,categorizedItems:L,sanitizedStructure:M,itemsReferencesMap:C}),[L,T,v,C,S,M,z]);return m(I.Provider,{value:q,children:e})},M=()=>{var e=n(I);if(!e)throw Error("useTrip must be used within a TripProvider");return e};function L(e){var{refetch:t}=M(),[o,a]=l(e),[i,n]=r(!1),c=s(async(e,r)=>{var o=await a(e,r);return o.error||(n(!0),await t().catch(e=>console.error(e)).finally(()=>n(!1))),o},[a,t]);return[{...o,fetching:o.fetching||i},c]}return e("useTripMutation",L),[()=>{y=k,e({TripContext:I=a(void 0),TripProvider:C,addDays:w,getItemReferenceId:O,getParentGeoIdFromTripSave:h,isHotelTripItem:v,isLocationItemObject:f,localizeTripCategoryName:T,useTrip:M,useTripMutation:L,useTripSaves:y})},[e=>(r=e.useState,o=e.useMemo,a=e.createContext,i=e.useEffect,s=e.useCallback,n=e.useContext),e=>(c=e.useQuery,u=e.useClient,l=e.useMutation),e=>(_=e.useLocalize,d=e.useCurrency,p=e.useIntlFormatter),e=>m=e.jsx,e=>g=e.isoStringToDate,e=>b=e.default]]},["o4yt4q","mqwhqn","7thqz4","21h32l","o5y7tg","dlu2yg"]]);
